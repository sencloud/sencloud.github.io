(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[369],{15600:e=>{e.exports={animated:"rainbow-text_animated__HQyO1",textShine:"rainbow-text_textShine__Rv_R5"}},20677:e=>{e.exports={loadingAnimation:"loading-animation_loadingAnimation__jdm64","bouncing-animation":"loading-animation_bouncing-animation___D_qJ",sm:"loading-animation_sm__PkjCK"}},70090:()=>{},85369:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>sr});var a=s(61195),n=s(85819),l=s(17783),r=s(4954),i=s(83551),o=s(38256),c=s(61316),d=s(94340),u=s(9260),m=s(45443),x=s(15600),h=s.n(x);function p(e){let{animated:t,className:s,children:n}=e;return(0,a.jsx)("span",{className:(0,r.cn)(t&&h().animated,s),children:n})}var f=s(46077);function g(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card",className:(0,r.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...s})}function j(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card-header",className:(0,r.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...s})}function v(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card-title",className:(0,r.cn)("leading-none font-semibold",t),...s})}function b(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card-description",className:(0,r.cn)("text-muted-foreground text-sm",t),...s})}function N(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card-content",className:(0,r.cn)("px-6",t),...s})}function w(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card-footer",className:(0,r.cn)("flex items-center px-6 [.border-t]:pt-6",t),...s})}var y=s(41773),A=s(9519),C=s(62132);function k(e){let{className:t}=e;return(0,a.jsxs)(i.P.div,{className:(0,r.cn)("flex flex-col",t),style:{transition:"all 0.2s ease-out"},initial:{opacity:0,scale:.85},animate:{opacity:1,scale:1},children:[(0,a.jsx)("h3",{className:"mb-2 text-center text-3xl font-light tracking-wider",children:"\uD83D\uDC4B 欢迎使用"}),(0,a.jsxs)("div",{className:"text-muted-foreground px-4 text-center text-lg font-light tracking-wider",children:[(0,a.jsx)("span",{className:"text-2xl tracking-[0.2em]",children:"新致智能助手"}),(0,a.jsx)("br",{}),(0,a.jsxs)("p",{className:"mt-4",children:[(0,a.jsx)("span",{className:"hidden sm:inline",children:"基于大语言模型的智能对话系统，"}),(0,a.jsx)("span",{className:"sm:hidden",children:"智能对话，"}),(0,a.jsx)("br",{}),(0,a.jsx)("span",{className:"hidden sm:inline",children:"为您提供专业、高效的"}),"智能服务支持。"]})]})]})}let S=["如何使用大语言模型提升企业效率？","智能知识库如何帮助企业管理和应用知识？","AI 助手在客户服务中的应用场景有哪些？","如何构建企业级的智能对话系统？"];function L(e){let{className:t,onSend:s}=e;return(0,a.jsxs)("div",{className:(0,r.cn)("flex flex-col items-center",t),children:[(0,a.jsx)("div",{className:"pointer-events-none fixed inset-0 flex items-center justify-center",children:(0,a.jsx)(k,{className:"pointer-events-auto mb-15 w-[75%] -translate-y-24"})}),(0,a.jsx)("ul",{className:"flex flex-wrap",children:S.map((e,t)=>(0,a.jsx)(i.P.li,{className:(0,r.cn)("flex w-1/2 shrink-0 p-2 active:scale-105",{"w-full sm:w-1/2":0===t,"hidden sm:flex":t>0}),style:{transition:"all 0.2s ease-out"},initial:{opacity:0,y:24},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2,delay:.1*t+.5,ease:"easeOut"},children:(0,a.jsx)("div",{className:"bg-card text-muted-foreground cursor-pointer rounded-2xl border px-4 py-4 text-sm font-light tracking-wider opacity-75 transition-all duration-300 hover:opacity-100 hover:shadow-md",onClick:()=>{null==s||s(e)},children:e})},e))})]})}var z=s(49962),M=s(14326),_=s(48283);function R(e){let{className:t}=e;return(0,a.jsx)("svg",{className:t,version:"1.1",width:"800px",height:"800px",viewBox:"0 0 512 512",children:(0,a.jsxs)("g",{fill:"currentcolor",children:[(0,a.jsx)("path",{d:"M392.692,257.322c-1.172-8.125-2.488-16.98-3.807-25.984c-5.856-39.012-12.59-81.688-14.86-87.832   c-4.318-11.715-18.371-44.723-68.217-25.984c-15.738,5.926-18.812,11.93-41.648,8.93c-17.273-2.27-28.326-15.59-52.336-24.668   c-49.844-18.883-71.584,11.711-75.902,23.422c-2.27,6.148-9.004,67.121-14.86,106.133c-1.39,8.86-2.633,17.566-3.804,25.621   c37.256,7.535,84.174,12.879,138.705,12.879C309.541,269.837,355.801,264.716,392.692,257.322z"}),(0,a.jsx)("path",{d:"M443.707,306.509c-8.051-2.196-16.834-4.246-26.057-6.148c-1.83-0.805-3.66-1.535-5.49-2.27h-0.072   c-46.918,10.394-102.254,15.664-156.125,15.664c-53.652,0-108.768-5.27-155.541-15.516c-1.316,0.512-2.707,1.098-4.098,1.684   c-8.858,1.828-17.348,3.73-25.106,5.781l-0.148,0.074C27.008,317.49,0,333.372,0,350.939c0,36.012,114.549,65.289,256.035,65.289   c141.34,0,255.965-29.278,255.965-65.289C512,333.74,486.016,318.22,443.707,306.509z"})]})})}var I=s(5833);function T(e){let{className:t,size:s,responding:o,feedback:c,onSend:d,onCancel:u,onRemoveFeedback:m}=e,[x,h]=(0,n.useState)(""),[p,g]=(0,n.useState)("inactive"),[j,v]=(0,n.useState)(0),b=(0,l.C$)(e=>e.general.enableBackgroundInvestigation),N=(0,n.useRef)(null),w=(0,n.useRef)(null);(0,n.useEffect)(()=>{c&&(h(""),setTimeout(()=>{w.current&&v(w.current.offsetWidth)},200)),setTimeout(()=>{var e;null==(e=N.current)||e.focus()},0)},[c]);let y=(0,n.useCallback)(()=>{if(o)null==u||u();else{if(""===x.trim())return;d&&(d(x,{interruptFeedback:null==c?void 0:c.option.value}),h(""),null==m||m())}},[o,u,x,d,c,m]),A=(0,n.useCallback)(e=>{!o&&("Enter"!==e.key||e.shiftKey||e.metaKey||e.ctrlKey||"inactive"!==p||(e.preventDefault(),y()))},[o,p,y]);return(0,a.jsxs)("div",{className:(0,r.cn)("bg-card relative rounded-[24px] border",t),children:[(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)(z.N,{children:c&&(0,a.jsxs)(i.P.div,{ref:w,className:"bg-background border-brand absolute top-0 left-0 mt-3 ml-2 flex items-center justify-center gap-1 rounded-2xl border px-2 py-0.5",initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},exit:{opacity:0,scale:0},transition:{duration:.2,ease:"easeInOut"},children:[(0,a.jsx)("div",{className:"text-brand flex h-full w-full items-center justify-center text-sm opacity-90",children:c.option.text}),(0,a.jsx)(M.A,{className:"cursor-pointer opacity-60",size:16,onClick:m})]})}),(0,a.jsx)("textarea",{ref:N,className:(0,r.cn)("m-0 w-full resize-none border-none px-4 py-3 text-lg","large"===s?"min-h-32":"min-h-4"),style:{textIndent:c?"".concat(j,"px"):0},placeholder:c?"请描述您是如何".concat(c.option.text,"的？"):"请输入您想了解的 AI 相关问题...",value:x,onCompositionStart:()=>g("active"),onCompositionEnd:()=>g("inactive"),onKeyDown:A,onChange:e=>{h(e.target.value)}})]}),(0,a.jsxs)("div",{className:"flex items-center px-4 py-2 -mt-5",children:[(0,a.jsx)("div",{className:"flex grow",children:(0,a.jsx)(I.m,{className:"max-w-60",title:(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"mb-2 font-bold",children:["深度分析模式：",b?"开启":"关闭"]}),(0,a.jsx)("p",{children:"开启后，AI 助手将进行更深入的分析和调研。 这对于需要详细解答的复杂问题特别有帮助。"})]}),children:(0,a.jsxs)(f.$,{className:(0,r.cn)("rounded-2xl text-sm font-light tracking-wider transition-all duration-200",b?"bg-brand/15 border-brand/80 text-brand hover:bg-brand/25 hover:border-brand shadow-[inset_0_0_8px_rgba(var(--brand-rgb),0.1)]":"hover:bg-gray-100 dark:hover:bg-gray-800"),variant:b?"outline":"ghost",size:"lg",onClick:()=>{(0,l.Qk)(!b)},children:[(0,a.jsx)(R,{className:(0,r.cn)("mr-2 transition-transform duration-200",b&&"scale-110 text-brand/90")}),"深度分析"]})})}),(0,a.jsx)("div",{className:"flex shrink-0 items-center gap-2",children:(0,a.jsx)(I.m,{title:o?"停止":"发送",children:(0,a.jsx)(f.$,{variant:"outline",size:"icon",className:(0,r.cn)("h-10 w-10 rounded-full"),onClick:y,children:o?(0,a.jsx)("div",{className:"flex h-10 w-10 items-center justify-center",children:(0,a.jsx)("div",{className:"bg-foreground h-4 w-4 rounded-sm opacity-70"})}):(0,a.jsx)(_.A,{})})})})]})]})}var P=s(85540),E=s(70873),F=s(7102),B=s(20677),O=s.n(B);function $(e){let{className:t,size:s="normal"}=e;return(0,a.jsxs)("div",{className:(0,r.cn)(O().loadingAnimation,"sm"===s&&O().sm,t),children:[(0,a.jsx)("div",{}),(0,a.jsx)("div",{}),(0,a.jsx)("div",{})]})}var H=s(84432);function D(e){let{className:t,children:s}=e;return(0,a.jsx)("span",{className:(0,r.cn)("relative flex h-[2em] items-center overflow-hidden",t),children:(0,a.jsx)(z.N,{mode:"popLayout",children:(0,a.jsx)(i.P.div,{className:"absolute w-fit",style:{transition:"all 0.3s ease-in-out"},initial:{y:"100%",opacity:0},animate:{y:"0%",opacity:1},exit:{y:"-100%",opacity:0},transition:{duration:.3,ease:"easeInOut"},children:s})})})}var U=s(59193),q=s(86874);function K(e){let{className:t,children:s,ref:n,...l}=e;return(0,a.jsxs)(q.bL,{"data-slot":"scroll-area",className:(0,r.cn)("relative",t),...l,children:[(0,a.jsx)(q.LM,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",ref:n,children:s}),(0,a.jsx)(J,{}),(0,a.jsx)(q.OK,{})]})}function J(e){let{className:t,orientation:s="vertical",...n}=e;return(0,a.jsx)(q.VM,{"data-slot":"scroll-area-scrollbar",orientation:s,className:(0,r.cn)("flex touch-none p-px transition-colors select-none","vertical"===s&&"h-full w-2.5 border-l border-l-transparent","horizontal"===s&&"h-2.5 flex-col border-t border-t-transparent",t),...n,children:(0,a.jsx)(q.lr,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}function X(e){let{className:t,children:s,scrollShadow:l=!0,scrollShadowColor:i="var(--background)",autoScrollToBottom:o=!1,ref:c}=e,{scrollRef:d,contentRef:u,scrollToBottom:m,isAtBottom:x}=(0,U.q)({initial:"instant"});(0,n.useImperativeHandle)(c,()=>({scrollToBottom(){x&&m()}}));let h=(0,n.useRef)(null),p=(0,n.useRef)(null);return(0,n.useEffect)(()=>{o?h.current&&p.current&&(d.current=h.current,u.current=p.current):(h.current=d.current,p.current=u.current,d.current=null,u.current=null)},[o,u,d]),(0,a.jsxs)("div",{className:(0,r.cn)("relative",t),children:[l&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:(0,r.cn)("absolute top-0 right-0 left-0 z-10 h-10 bg-gradient-to-t","from-transparent to-[var(--scroll-shadow-color)]"),style:{"--scroll-shadow-color":i}}),(0,a.jsx)("div",{className:(0,r.cn)("absolute right-0 bottom-0 left-0 z-10 h-10 bg-gradient-to-b","from-transparent to-[var(--scroll-shadow-color)]"),style:{"--scroll-shadow-color":i}})]}),(0,a.jsx)(K,{ref:d,className:"h-full w-full",children:(0,a.jsx)("div",{className:"h-fit w-full",ref:u,children:s})})]})}var Q=s(23970);function G(e){let{className:t,onFeedback:s,onSendMessage:i}=e,o=(0,n.useRef)(null),c=(0,l.Tu)(),d=(0,l.y$)(),u=(0,l.dF)(),m=(0,l.Pj)(e=>e.responding),x=(0,l.Pj)(e=>null===e.ongoingResearchId),h=(0,l.Pj)(e=>e.ongoingResearchId===e.openResearchId),p=(0,n.useCallback)(()=>{let e=setTimeout(()=>{o.current&&o.current.scrollToBottom()},500);return()=>{clearTimeout(e)}},[]);return(0,a.jsxs)(X,{className:(0,r.cn)("flex h-full w-full flex-col overflow-hidden",t),scrollShadowColor:"var(--app-background)",autoScrollToBottom:!0,ref:o,children:[(0,a.jsxs)("ul",{className:"flex flex-col",children:[c.map(e=>(0,a.jsx)(W,{messageId:e,waitForFeedback:u===e,interruptMessage:d,onFeedback:s,onSendMessage:i,onToggleResearch:p},e)),(0,a.jsx)("div",{className:"flex h-8 w-full shrink-0"})]}),m&&(x||!h)&&(0,a.jsx)($,{className:"ml-4"})]})}function W(e){let{className:t,messageId:s,waitForFeedback:o,interruptMessage:c,onFeedback:d,onSendMessage:u,onToggleResearch:m}=e,x=(0,l.JX)(s),h=(0,l.Pj)(e=>e.researchIds),p=(0,n.useMemo)(()=>h.includes(s),[h,s]);if(x){if("user"===x.role||"assistant"===x.role||"coordinator"===x.agent||"planner"===x.agent||"podcast"===x.agent||p){let e;if(e="planner"===x.agent?(0,a.jsx)("div",{className:"w-full px-4",children:(0,a.jsx)(ee,{message:x,waitForFeedback:o,interruptMessage:c,onFeedback:d,onSendMessage:u})}):"podcast"===x.agent?(0,a.jsx)("div",{className:"w-full px-4",children:(0,a.jsx)(et,{message:x})}):p?(0,a.jsx)("div",{className:"w-full px-4",children:(0,a.jsx)(Z,{researchId:x.id,onToggleResearch:m})}):x.content?(0,a.jsx)("div",{className:(0,r.cn)("flex w-full px-4","user"===x.role&&"justify-end",t),children:(0,a.jsx)(Y,{message:x,children:(0,a.jsx)("div",{className:"flex w-full flex-col",children:(0,a.jsx)(H.o,{children:null==x?void 0:x.content})})})}):null)return(0,a.jsx)(i.P.li,{className:"mt-10",initial:{opacity:0,y:24},animate:{opacity:1,y:0},style:{transition:"all 0.2s ease-out"},transition:{duration:.2,ease:"easeOut"},children:e},s)}return null}}function Y(e){let{className:t,message:s,children:n}=e;return(0,a.jsx)("div",{className:(0,r.cn)("flex w-fit max-w-[85%] flex-col rounded-2xl px-4 py-3 shadow","user"===s.role&&"text-primary-foreground bg-brand rounded-ee-none","assistant"===s.role&&"bg-muted rounded-es-none",t),children:n})}function Z(e){let{className:t,researchId:s,onToggleResearch:i}=e,o=(0,l.Pj)(e=>e.researchReportIds.get(s)),c=void 0!==o,d=(0,l.Pj)(e=>c&&e.messages.get(o).isStreaming),u=(0,l.Pj)(e=>e.openResearchId),m=(0,n.useMemo)(()=>c?d?"正在生成报告...":"报告已生成":"正在研究...",[c,d]),x=(0,l.s1)(s),h=(0,n.useMemo)(()=>{if(x){var e;return(0,Q.Ol)(null!=(e=x.content)?e:"",{title:""}).title}},[x]),b=(0,n.useCallback)(()=>{u===s?(0,l.mR)():(0,l.y8)(s),null==i||i()},[u,s,i]);return(0,a.jsxs)(g,{className:(0,r.cn)("w-full",t),children:[(0,a.jsx)(j,{children:(0,a.jsx)(v,{children:(0,a.jsx)(p,{animated:"报告已生成"!==m,children:void 0!==h&&""!==h?h:"深入思考并整理思路"})})}),(0,a.jsx)(w,{children:(0,a.jsxs)("div",{className:"flex w-full",children:[(0,a.jsx)(D,{className:"text-muted-foreground flex-grow text-sm",children:m}),(0,a.jsx)(f.$,{variant:u?"outline":"default",onClick:b,children:s!==u?"打开":"关闭"})]})})]})}let V=["酷","听起来不错","看起来不错","很棒","很棒"];function ee(e){var t;let{className:s,message:l,interruptMessage:o,onFeedback:c,waitForFeedback:d,onSendMessage:u}=e,m=(0,n.useMemo)(()=>{var e;return(0,Q.Ol)(null!=(e=l.content)?e:"",{})},[l.content]),x=(0,n.useCallback)(async()=>{u&&u("".concat(V[Math.floor(Math.random()*V.length)],"! ").concat(Math.random()>.5?"让我们开始研究吧":"让我们开始吧"),{interruptFeedback:"accepted"})},[u]);return(0,a.jsxs)(g,{className:(0,r.cn)("w-full",s),children:[(0,a.jsx)(j,{children:(0,a.jsx)(v,{children:(0,a.jsx)(H.o,{animated:!0,children:"### ".concat(void 0!==m.title&&""!==m.title?m.title:"深入思考并整理思路")})})}),(0,a.jsxs)(N,{children:[(0,a.jsx)(H.o,{className:"opacity-80",animated:!0,children:m.thought}),m.steps&&(0,a.jsx)("ul",{className:"my-2 flex list-decimal flex-col gap-4 border-l-[2px] pl-8",children:m.steps.map((e,t)=>(0,a.jsxs)("li",{children:[(0,a.jsx)("h3",{className:"mb text-lg font-medium",children:(0,a.jsx)(H.o,{animated:!0,children:e.title})}),(0,a.jsx)("div",{className:"text-muted-foreground text-sm",children:(0,a.jsx)(H.o,{animated:!0,children:e.description})})]},"step-".concat(t)))})]}),(0,a.jsx)(w,{className:"flex justify-end",children:!l.isStreaming&&(null==o||null==(t=o.options)?void 0:t.length)&&(0,a.jsx)(i.P.div,{className:"flex gap-2",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.3,delay:.3},children:null==o?void 0:o.options.map(e=>(0,a.jsx)(f.$,{variant:"accepted"===e.value?"default":"outline",disabled:!d,onClick:()=>{"accepted"===e.value?x():null==c||c({option:e})},children:e.text},e.value))})})]})}function et(e){let{className:t,message:s}=e,l=(0,n.useMemo)(()=>{var e;return JSON.parse(null!=(e=s.content)?e:"")},[s.content]),i=(0,n.useMemo)(()=>null==l?void 0:l.title,[l]),o=(0,n.useMemo)(()=>null==l?void 0:l.audioUrl,[l]),c=(0,n.useMemo)(()=>s.isStreaming,[s.isStreaming]),d=(0,n.useMemo)(()=>(null==l?void 0:l.error)!==void 0,[l]),[u,m]=(0,n.useState)(!1);return(0,a.jsxs)(g,{className:(0,r.cn)("w-[508px]",t),children:[(0,a.jsxs)(j,{children:[(0,a.jsxs)("div",{className:"text-muted-foreground flex items-center justify-between text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[c?(0,a.jsx)(P.A,{}):(0,a.jsx)(E.A,{size:16}),d?(0,a.jsx)("div",{className:"text-red-500",children:"生成播客时出错。请重试。"}):(0,a.jsx)(p,{animated:c,children:c?"正在生成播客...":u?"正在播放播客...":"播客"})]}),!d&&!c&&(0,a.jsx)("div",{className:"flex",children:(0,a.jsx)(I.m,{title:"Download podcast",children:(0,a.jsx)(f.$,{variant:"ghost",size:"icon",asChild:!0,children:(0,a.jsx)("a",{href:o,download:"".concat((null!=i?i:"podcast").replaceAll(" ","-"),".mp3"),children:(0,a.jsx)(F.A,{size:16})})})})})]}),(0,a.jsx)(v,{children:(0,a.jsx)("div",{className:"text-lg font-medium",children:(0,a.jsx)(p,{animated:c,children:i})})})]}),(0,a.jsx)(N,{children:o?(0,a.jsx)("audio",{className:"w-full",src:o,controls:!0,onPlay:()=>m(!0),onPause:()=>m(!1)}):(0,a.jsx)("div",{className:"w-full"})})]})}function es(e){let{className:t,selectedChatId:s}=e,x=(0,l.Tu)().length,h=(0,l.Pj)(e=>e.responding),{isReplay:N}=(0,A.N)(),{title:w,hasError:S}=function(){let{isReplay:e}=(0,A.N)(),[t,s]=(0,n.useState)(null),a=(0,n.useRef)(!1),[l,r]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{e&&(t||a.current||(a.current=!0,(0,C.M0)().then(e=>{r(!1),s(null!=e?e:null),e&&(document.title="".concat(e," - DeerFlow"))}).catch(()=>{r(!0),s("Error: the replay is not available."),document.title="DeerFlow"}).finally(()=>{a.current=!1})))},[a,e,t]),{title:t,isLoading:a,hasError:l}}(),[z,M]=(0,n.useState)(!1),_=(0,n.useRef)(null),[R,I]=(0,n.useState)(null);(0,n.useEffect)(()=>{s?(async()=>{let e=localStorage.getItem("auth_token"),t=l.Pj.getState().userId;if(e&&t)try{let a=await fetch((0,u.$)("reports/thread/".concat(s,"?user_id=").concat(t)),{headers:{Authorization:"Bearer ".concat(e)}});if(!a.ok)throw Error("Failed to load chat history");let n=await a.json();if(console.log("Received report:",n),n.messages&&Array.isArray(n.messages)){let e=n.messages.map(e=>({id:e.id||(0,m.Ak)(),threadId:s,role:e.role||"assistant",agent:e.agent||"assistant",content:e.content||"",contentChunks:[e.content||""],isStreaming:!1,created_at:e.created_at,finishReason:e.finish_reason||null,toolCalls:e.tool_calls||[],toolCallResults:e.tool_call_results||[]}));console.log("Formatted messages:",e),l.Pj.setState({messageIds:[],messages:new Map}),l.Pj.getState().updateMessages(e)}}catch(e){console.error("Failed to load chat history:",e),d.oR.error("Failed to load chat history")}})():l.Pj.setState({messageIds:[],messages:new Map})},[s]);let P=(0,n.useCallback)(async(e,t)=>{let a=new AbortController;_.current=a;try{var n;await (0,l._z)(e,{interruptFeedback:null!=(n=null==t?void 0:t.interruptFeedback)?n:null==R?void 0:R.option.value,chatId:s},{abortSignal:a.signal})}catch(e){}},[R,s]),E=(0,n.useCallback)(()=>{var e;null==(e=_.current)||e.abort(),_.current=null},[]),F=(0,n.useCallback)(e=>{I(e)},[I]),B=(0,n.useCallback)(()=>{I(null)},[I]),O=(0,n.useCallback)(()=>{M(!0),(0,l._z)()},[M]),[$,H]=(0,n.useState)(!1),D=(0,n.useCallback)(()=>{H(!$),(0,y.DU)(!$)},[$]);return(0,a.jsxs)("div",{className:(0,r.cn)("flex h-full flex-col overflow-hidden",t),children:[(0,a.jsx)(G,{className:"flex-1 overflow-y-auto px-1 sm:px-0",onFeedback:F,onSendMessage:P}),N?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:(0,r.cn)("fixed bottom-[calc(50vh+50px)] sm:bottom-[calc(50vh+80px)] left-0 transition-all duration-500 ease-out px-2 sm:px-0",z&&"pointer-events-none scale-150 opacity-0"),children:(0,a.jsx)(k,{})}),(0,a.jsx)(i.P.div,{className:"mb-2 sm:mb-4 h-fit w-full items-center justify-center px-2 sm:px-0",initial:{opacity:0,y:"20vh"},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,a.jsxs)(g,{className:(0,r.cn)("w-full transition-all duration-300",!z&&"translate-y-[-40vh]"),children:[(0,a.jsx)("div",{className:"flex-grow",children:(0,a.jsxs)(j,{className:"p-3 sm:p-6",children:[(0,a.jsx)(v,{className:"text-base sm:text-lg",children:(0,a.jsx)(p,{animated:h,children:h?"正在回放":"".concat(w)})}),(0,a.jsx)(b,{className:"text-xs sm:text-sm",children:(0,a.jsx)(p,{animated:h,children:h?"新致智能 正在回放对话...":z?"回放已停止。":'您现在处于回放模式。点击右侧"播放"按钮开始。'})})]})}),(0,a.jsxs)("div",{className:"flex items-center justify-end gap-2 p-3 sm:p-6",children:[(0,a.jsxs)(f.$,{variant:"outline",size:"sm",className:"gap-2",onClick:D,children:[(0,a.jsx)(o.A,{size:16}),$?"正常速度":"快进"]}),(0,a.jsxs)(f.$,{variant:"default",size:"sm",className:"gap-2",onClick:O,disabled:z,children:[(0,a.jsx)(c.A,{size:16}),"播放"]})]})]})})]}):(0,a.jsxs)("div",{className:"relative flex h-32 sm:h-42 shrink-0 pb-2 sm:pb-4",children:[!h&&0===x&&(0,a.jsx)(L,{className:"absolute top-[-160px] sm:top-[-218px] left-0 w-full px-2 sm:px-0",onSend:P}),(0,a.jsx)(T,{className:"h-full w-full",responding:h,feedback:R,onSend:P,onCancel:E,onRemoveFeedback:B})]})]})}var ea=s(51526),en=s(40511),el=s(22097),er=s(16687),ei=s(28830),eo=s(62930),ec=s(1246),ed=s(25858),eu=s(48103),em=s(52844),ex=s(92),eh=s(34230);function ep(e){let{className:t,url:s,title:n}=e;return(0,a.jsx)("img",{className:(0,r.cn)("bg-accent h-4 w-4 rounded-full shadow-sm",t),width:16,height:16,src:new URL(s).origin+"/favicon.ico",alt:n,onError:e=>{e.currentTarget.src="https://perishablepress.com/wp/wp-content/images/2021/favicon-standard.png"}})}var ef=s(40115),eg=s(59900),ej=s(30996);function ev(e){let{...t}=e;return(0,a.jsx)(eg.bL,{"data-slot":"accordion",...t})}function eb(e){let{className:t,...s}=e;return(0,a.jsx)(eg.q7,{"data-slot":"accordion-item",className:(0,r.cn)("border-b last:border-b-0",t),...s})}function eN(e){let{className:t,children:s,...n}=e;return(0,a.jsx)(eg.Y9,{className:"flex",children:(0,a.jsxs)(eg.l9,{"data-slot":"accordion-trigger",className:(0,r.cn)("focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 items-start justify-between gap-4 rounded-md py-4 text-left text-sm font-medium transition-all outline-none hover:underline focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180",t),...n,children:[s,(0,a.jsx)(ej.A,{className:"text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200"})]})})}function ew(e){let{className:t,children:s,...n}=e;return(0,a.jsx)(eg.UC,{"data-slot":"accordion-content",className:"data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm",...n,children:(0,a.jsx)("div",{className:(0,r.cn)("pt-0 pb-4",t),children:s})})}function ey(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"skeleton",className:(0,r.cn)("bg-accent animate-pulse rounded-md",t),...s})}var eA=s(53166);function eC(e){let{className:t,researchId:s}=e,n=(0,l.Pj)(e=>e.researchActivityIds.get(s)),o=(0,l.Pj)(e=>e.ongoingResearchId===s);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("ul",{className:(0,r.cn)("flex flex-col py-4",t),children:n.map((e,t)=>0!==t&&(0,a.jsxs)(i.P.li,{style:{transition:"all 0.4s ease-out"},initial:{opacity:0,y:24},animate:{opacity:1,y:0},transition:{duration:.4,ease:"easeOut"},children:[(0,a.jsx)(ek,{messageId:e}),(0,a.jsx)(eS,{messageId:e}),t!==n.length-1&&(0,a.jsx)("hr",{className:"my-8"})]},e))}),o&&(0,a.jsx)($,{className:"mx-4 my-12"})]})}function ek(e){let{messageId:t}=e,s=(0,l.JX)(t);return(null==s?void 0:s.agent)&&s.content&&"reporter"!==s.agent&&"planner"!==s.agent?(0,a.jsx)("div",{className:"px-4 py-2",children:(0,a.jsx)(H.o,{animated:!0,children:s.content})}):null}function eS(e){let{messageId:t}=e,s=(0,l.JX)(t);if(s){var n;if(!s.isStreaming&&(null==(n=s.toolCalls)?void 0:n.length))for(let e of s.toolCalls)if("web_search"===e.name)return(0,a.jsx)(ez,{toolCall:e},e.id);else if("crawl_tool"===e.name)return(0,a.jsx)(eM,{toolCall:e},e.id);else if("python_repl_tool"===e.name)return(0,a.jsx)(e_,{toolCall:e},e.id);else return(0,a.jsx)(eI,{toolCall:e},e.id)}return null}let eL=new ei.q({max:100});function ez(e){let{toolCall:t}=e,s=(0,n.useMemo)(()=>void 0===t.result,[t.result]),l=(0,n.useMemo)(()=>{let e;try{e=t.result?(0,Q.Ol)(t.result,[]):void 0}catch(t){e=void 0}return Array.isArray(e)?e.forEach(e=>{"page"===e.type&&eL.set(e.url,e.title)}):e=[],e},[t.result]),r=(0,n.useMemo)(()=>null==l?void 0:l.filter(e=>"page"===e.type),[l]),o=(0,n.useMemo)(()=>null==l?void 0:l.filter(e=>"image"===e.type),[l]);return(0,a.jsxs)("section",{className:"mt-4 pl-4",children:[(0,a.jsx)("div",{className:"font-medium italic",children:(0,a.jsxs)(p,{className:"flex items-center",animated:void 0===l,children:[(0,a.jsx)(eo.A,{size:16,className:"mr-2"}),(0,a.jsx)("span",{children:"Searching for\xa0"}),(0,a.jsx)("span",{className:"max-w-[500px] overflow-hidden text-ellipsis whitespace-nowrap",children:t.args.query})]})}),(0,a.jsx)("div",{className:"pr-4",children:r&&(0,a.jsxs)("ul",{className:"mt-2 flex flex-wrap gap-4",children:[s&&[...Array(6)].map((e,t)=>(0,a.jsx)("li",{className:"flex h-40 w-40 gap-2 rounded-md text-sm",children:(0,a.jsx)(ey,{className:"to-accent h-full w-full rounded-md bg-gradient-to-tl from-slate-400",style:{animationDelay:"".concat(.2*t,"s")}})},"search-result-".concat(t))),r.filter(e=>"page"===e.type).map((e,t)=>(0,a.jsxs)(i.P.li,{className:"text-muted-foreground bg-accent flex max-w-40 gap-2 rounded-md px-2 py-1 text-sm",initial:{opacity:0,y:10,scale:.66},animate:{opacity:1,y:0,scale:1},transition:{duration:.2,delay:.1*t,ease:"easeOut"},children:[(0,a.jsx)(ep,{className:"mt-1",url:e.url,title:e.title}),(0,a.jsx)("a",{href:e.url,target:"_blank",children:e.title})]},"search-result-".concat(t))),o.map((e,t)=>(0,a.jsx)(i.P.li,{initial:{opacity:0,y:10,scale:.66},animate:{opacity:1,y:0,scale:1},transition:{duration:.2,delay:.1*t,ease:"easeOut"},children:(0,a.jsx)("a",{className:"flex flex-col gap-2 overflow-hidden rounded-md opacity-75 transition-opacity duration-300 hover:opacity-100",href:e.image_url,target:"_blank",children:(0,a.jsx)(ef.A,{src:e.image_url,alt:e.image_description,className:"bg-accent h-40 w-40 max-w-full rounded-md bg-cover bg-center bg-no-repeat",imageClassName:"hover:scale-110",imageTransition:!0})})},"search-result-".concat(t)))]})})]})}function eM(e){let{toolCall:t}=e,s=(0,n.useMemo)(()=>t.args.url,[t.args]),l=(0,n.useMemo)(()=>eL.get(s),[s]);return(0,a.jsxs)("section",{className:"mt-4 pl-4",children:[(0,a.jsx)("div",{children:(0,a.jsxs)(p,{className:"flex items-center text-base font-medium italic",animated:void 0===t.result,children:[(0,a.jsx)(ec.A,{size:16,className:"mr-2"}),(0,a.jsx)("span",{children:"Reading"})]})}),(0,a.jsx)("ul",{className:"mt-2 flex flex-wrap gap-4",children:(0,a.jsxs)(i.P.li,{className:"text-muted-foreground bg-accent flex h-40 w-40 gap-2 rounded-md px-2 py-1 text-sm",initial:{opacity:0,y:10,scale:.66},animate:{opacity:1,y:0,scale:1},transition:{duration:.2,ease:"easeOut"},children:[(0,a.jsx)(ep,{className:"mt-1",url:s,title:l}),(0,a.jsx)("a",{className:"h-full flex-grow overflow-hidden text-ellipsis whitespace-nowrap",href:s,target:"_blank",children:null!=l?l:s})]})})]})}function e_(e){let{toolCall:t}=e,s=(0,n.useMemo)(()=>t.args.code,[t.args]),{resolvedTheme:l}=(0,eu.D)();return(0,a.jsxs)("section",{className:"mt-4 pl-4",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(er.A,{className:"mr-2"}),(0,a.jsx)(p,{className:"text-base font-medium italic",animated:void 0===t.result,children:"Running Python code"})]}),(0,a.jsx)("div",{children:(0,a.jsx)("div",{className:"bg-accent mt-2 max-h-[400px] max-w-[calc(100%-120px)] overflow-y-auto rounded-md p-2 text-sm",children:(0,a.jsx)(em.A,{language:"python",style:"dark"===l?eh.A:ex.A,customStyle:{background:"transparent",border:"none",boxShadow:"none"},children:s.trim()})})}),t.result&&(0,a.jsx)(eR,{result:t.result})]})}function eR(e){var t;let{result:s}=e,{resolvedTheme:l}=(0,eu.D)(),r=(0,n.useMemo)(()=>s.includes("Error executing code:\n"),[s]),i=(0,n.useMemo)(()=>{if(r){let e=s.split("```\nError: ");if(e.length>1)return e[1].trim()}return null},[s,r]),o=(0,n.useMemo)(()=>{if(!r){let e=s.split("```\nStdout: ");if(e.length>1)return e[1].trim()}return null},[s,r]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mt-4 font-medium italic",children:r?"Error when executing the above code":"Execution output"}),(0,a.jsx)("div",{className:"bg-accent mt-2 max-h-[400px] max-w-[calc(100%-120px)] overflow-y-auto rounded-md p-2 text-sm",children:(0,a.jsx)(em.A,{language:"plaintext",style:"dark"===l?eh.A:ex.A,customStyle:{color:r?"red":"inherit",background:"transparent",border:"none",boxShadow:"none"},children:null!=(t=null!=i?i:o)?t:"(empty)"})})]})}function eI(e){let{toolCall:t}=e,s=(0,n.useMemo)(()=>(0,eA.K)(t.name),[t.name]),{resolvedTheme:l}=(0,eu.D)();return(0,a.jsx)("section",{className:"mt-4 pl-4",children:(0,a.jsx)("div",{className:"w-fit overflow-y-auto rounded-md py-0",children:(0,a.jsx)(ev,{type:"single",collapsible:!0,className:"w-full",children:(0,a.jsxs)(eb,{value:"item-1",children:[(0,a.jsx)(eN,{children:(0,a.jsx)(I.m,{title:null==s?void 0:s.description,children:(0,a.jsxs)("div",{className:"flex items-center font-medium italic",children:[(0,a.jsx)(ed.A,{size:16,className:"mr-2"}),(0,a.jsxs)(p,{className:"pr-0.5 text-base font-medium italic",animated:void 0===t.result,children:["Running ",t.name?t.name+"()":"MCP tool"]})]})})}),(0,a.jsx)(ew,{children:t.result&&(0,a.jsx)("div",{className:"bg-accent max-h-[400px] max-w-[560px] overflow-y-auto rounded-md text-sm",children:(0,a.jsx)(em.A,{language:"json",style:"dark"===l?eh.A:ex.A,customStyle:{background:"transparent",border:"none",boxShadow:"none"},children:t.result.trim()})})})]})})})})}var eT=s(1701),eP=s(9417),eE=s(22290),eF=s(93671),eB=s(80689),eO=s(21053),e$=s(13319),eH=s(24603),eD=s(81439),eU=s(54737),eq=s(62620),eK=s(79601),eJ=s(91807),eX=s(94324),eQ=s(78545),eG=s(34691),eW=s(26695),eY=s(82463),eZ=s(24155),eV=s(44004),e0=s(44249),e1=s(7178);let e2=eT.RI,e4=eT.Or,e3=eE.Ay.configure({HTMLAttributes:{class:(0,eV.cx)("text-muted-foreground underline underline-offset-[3px] hover:text-primary transition-colors cursor-pointer")}});eF.Ay.extend({addProseMirrorPlugins:()=>[(0,eT.bh)({imageClass:(0,eV.cx)("opacity-40 rounded-lg border border-stone-200")})]}).configure({allowBase64:!0,HTMLAttributes:{class:(0,eV.cx)("rounded-lg border border-muted")}});let e5=eT.zL.configure({HTMLAttributes:{class:(0,eV.cx)("rounded-lg border border-muted")}}),e6=eB._.configure({HTMLAttributes:{class:(0,eV.cx)("not-prose pl-2 ")}}),e8=eO.L2.configure({HTMLAttributes:{class:(0,eV.cx)("flex gap-2 items-start my-4")},nested:!0}),e7=eT.d$.configure({HTMLAttributes:{class:(0,eV.cx)("mt-4 mb-6 border-t border-muted-foreground")}}),e9=e$.A.configure({bulletList:{HTMLAttributes:{class:(0,eV.cx)("list-disc list-outside leading-3 -mt-2")}},orderedList:{HTMLAttributes:{class:(0,eV.cx)("list-decimal list-outside leading-3 -mt-2")}},listItem:{HTMLAttributes:{class:(0,eV.cx)("leading-normal -mb-2")}},blockquote:{HTMLAttributes:{class:(0,eV.cx)("border-l-4 border-primary")}},codeBlock:!1,code:{HTMLAttributes:{class:(0,eV.cx)("rounded-md bg-muted  px-1.5 py-1 font-mono font-medium"),spellcheck:"false"}},horizontalRule:!1,dropcursor:{color:"#DBEAFE",width:4},gapcursor:!1}),te=eH.A.configure({lowlight:(0,e0.$)(e1.l)}),tt=eD.A.configure({HTMLAttributes:{class:(0,eV.cx)("rounded-lg border border-muted")},inline:!1}),ts=eT.KK.configure({HTMLAttributes:{class:(0,eV.cx)("not-prose")},inline:!1}),ta=eT.Rs.configure({HTMLAttributes:{class:(0,eV.cx)("text-foreground rounded p-1 hover:bg-accent cursor-pointer")},katexOptions:{throwOnError:!1}}),tn=eU.A.configure(),tl=eG.XI.configure(),tr=eY.H.configure(),ti=eZ.n.configure(),to=eW.A.configure(),tc=eQ.o.configure({html:!0,tightLists:!0,tightListClass:"tight",bulletListMarker:"-",linkify:!1,breaks:!1,transformPastedText:!1,transformCopiedText:!1}),td=eq.A.configure({}),tu=[e9,e4,e3,e5,e6,e8,tl,tr,ti,to,e7,e2,te,tt,ts,ta,tn,eK.A,tc,eT.So,eJ.A,eX.Q,eT.lK,td];var tm=s(81660),tx=s(50274);function th(e){let{...t}=e;return(0,a.jsx)(tx.bL,{"data-slot":"popover",...t})}function tp(e){let{...t}=e;return(0,a.jsx)(tx.l9,{"data-slot":"popover-trigger",...t})}function tf(e){let{className:t,align:s="center",sideOffset:n=4,...l}=e;return(0,a.jsx)(tx.ZL,{children:(0,a.jsx)(tx.UC,{"data-slot":"popover-content",align:s,sideOffset:n,className:(0,r.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",t),...l})})}let tg=[{name:"Default",color:"var(--novel-black)"},{name:"Purple",color:"#9333EA"},{name:"Red",color:"#E00000"},{name:"Yellow",color:"#EAB308"},{name:"Blue",color:"#2563EB"},{name:"Green",color:"#008A00"},{name:"Orange",color:"#FFA500"},{name:"Pink",color:"#BA4081"},{name:"Gray",color:"#A8A29E"}],tj=[{name:"Default",color:"var(--novel-highlight-default)"},{name:"Purple",color:"var(--novel-highlight-purple)"},{name:"Red",color:"var(--novel-highlight-red)"},{name:"Yellow",color:"var(--novel-highlight-yellow)"},{name:"Blue",color:"var(--novel-highlight-blue)"},{name:"Green",color:"var(--novel-highlight-green)"},{name:"Orange",color:"var(--novel-highlight-orange)"},{name:"Pink",color:"var(--novel-highlight-pink)"},{name:"Gray",color:"var(--novel-highlight-gray)"}],tv=e=>{let{open:t,onOpenChange:s}=e,{editor:n}=(0,tm.aA)();if(!n)return null;let l=tg.find(e=>{let{color:t}=e;return n.isActive("textStyle",{color:t})}),r=tj.find(e=>{let{color:t}=e;return n.isActive("highlight",{color:t})});return(0,a.jsxs)(th,{modal:!0,open:t,onOpenChange:s,children:[(0,a.jsx)(tp,{asChild:!0,children:(0,a.jsxs)(f.$,{size:"sm",className:"gap-2 rounded-none",variant:"ghost",children:[(0,a.jsx)("span",{className:"rounded-sm px-1",style:{color:null==l?void 0:l.color,backgroundColor:null==r?void 0:r.color},children:"A"}),(0,a.jsx)(ej.A,{className:"h-4 w-4"})]})}),(0,a.jsxs)(tf,{sideOffset:5,className:"my-1 flex max-h-80 w-48 flex-col overflow-hidden overflow-y-auto rounded border p-1 shadow-xl",align:"start",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("div",{className:"text-muted-foreground my-1 px-2 text-sm font-semibold",children:"Color"}),tg.map(e=>{let{name:t,color:l}=e;return(0,a.jsx)(eT.nR,{onSelect:()=>{n.commands.unsetColor(),"Default"!==t&&n.chain().focus().setColor(l||"").run(),s(!1)},className:"hover:bg-accent flex cursor-pointer items-center justify-between px-2 py-1 text-sm",children:(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"rounded-sm border px-2 py-px font-medium",style:{color:l},children:"A"}),(0,a.jsx)("span",{children:t})]})},t)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-muted-foreground my-1 px-2 text-sm font-semibold",children:"Background"}),tj.map(e=>{let{name:t,color:l}=e;return(0,a.jsxs)(eT.nR,{onSelect:()=>{n.commands.unsetHighlight(),"Default"!==t&&n.chain().focus().setHighlight({color:l}).run(),s(!1)},className:"hover:bg-accent flex cursor-pointer items-center justify-between px-2 py-1 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"rounded-sm border px-2 py-px font-medium",style:{backgroundColor:l},children:"A"}),(0,a.jsx)("span",{children:t})]}),n.isActive("highlight",{color:l})&&(0,a.jsx)(ea.A,{className:"h-4 w-4"})]},t)})]})]})]})};var tb=s(66124);let tN=e=>{let{open:t,onOpenChange:s}=e,l=(0,n.useRef)(null),{editor:i}=(0,tm.aA)();return((0,n.useEffect)(()=>{var e;null==(e=l.current)||e.focus()}),i)?(0,a.jsxs)(tx.AM,{modal:!0,open:t,onOpenChange:s,children:[(0,a.jsx)(tx.Wv,{asChild:!0,children:(0,a.jsxs)(f.$,{size:"sm",variant:"ghost",className:"gap-2 rounded-none border-none",children:[(0,a.jsx)("p",{className:"text-base",children:"↗"}),(0,a.jsx)("p",{className:(0,r.cn)("underline decoration-stone-400 underline-offset-4",{"text-blue-500":i.isActive("link")}),children:"Link"})]})}),(0,a.jsx)(tf,{align:"start",className:"w-60 p-0",sideOffset:10,children:(0,a.jsxs)("form",{onSubmit:e=>{let t=e.currentTarget;e.preventDefault();let a=function(e){if(function(e){try{return new URL(e),!0}catch(e){return!1}}(e))return e;try{if(e.includes(".")&&!e.includes(" "))return new URL("https://".concat(e)).toString()}catch(e){return null}}(t[0].value);a&&(i.chain().focus().setLink({href:a}).run(),s(!1))},className:"flex p-1",children:[(0,a.jsx)("input",{ref:l,type:"text",placeholder:"Paste a link",className:"bg-background flex-1 p-1 text-sm outline-none",defaultValue:i.getAttributes("link").href||""}),i.getAttributes("link").href?(0,a.jsx)(f.$,{size:"icon",variant:"outline",type:"button",className:"flex h-8 items-center rounded-sm p-1 text-red-600 transition-all hover:bg-red-100 dark:hover:bg-red-800",onClick:()=>{i.chain().focus().unsetLink().run(),l.current&&(l.current.value=""),s(!1)},children:(0,a.jsx)(tb.A,{className:"h-4 w-4"})}):(0,a.jsx)(f.$,{size:"icon",className:"h-8",children:(0,a.jsx)(ea.A,{className:"h-4 w-4"})})]})})]}):null};var tw=s(29873);let ty=()=>{let{editor:e}=(0,tm.aA)();return e?(0,a.jsx)(f.$,{variant:"ghost",size:"sm",className:"w-12 rounded-none",onClick:t=>{if(e.isActive("math"))e.chain().focus().unsetLatex().run();else{let{from:t,to:s}=e.state.selection,a=e.state.doc.textBetween(t,s);if(!a)return;e.chain().focus().setLatex({latex:a}).run()}},children:(0,a.jsx)(tw.A,{className:(0,r.cn)("size-4",{"text-blue-500":e.isActive("math")}),strokeWidth:2.3})}):null};var tA=s(45461),tC=s(18422),tk=s(61083),tS=s(16856),tL=s(43063),tz=s(44918),tM=s(50836),t_=s(61079);let tR=[{name:"Text",icon:tA.A,command:e=>e.chain().focus().clearNodes().run(),isActive:e=>e.isActive("paragraph")&&!e.isActive("bulletList")&&!e.isActive("orderedList")},{name:"Heading 1",icon:tC.A,command:e=>e.chain().focus().clearNodes().toggleHeading({level:1}).run(),isActive:e=>e.isActive("heading",{level:1})},{name:"Heading 2",icon:tk.A,command:e=>e.chain().focus().clearNodes().toggleHeading({level:2}).run(),isActive:e=>e.isActive("heading",{level:2})},{name:"Heading 3",icon:tS.A,command:e=>e.chain().focus().clearNodes().toggleHeading({level:3}).run(),isActive:e=>e.isActive("heading",{level:3})},{name:"To-do List",icon:tL.A,command:e=>e.chain().focus().clearNodes().toggleTaskList().run(),isActive:e=>e.isActive("taskItem")},{name:"Bullet List",icon:tz.A,command:e=>e.chain().focus().clearNodes().toggleBulletList().run(),isActive:e=>e.isActive("bulletList")},{name:"Numbered List",icon:tz.A,command:e=>e.chain().focus().clearNodes().toggleOrderedList().run(),isActive:e=>e.isActive("orderedList")},{name:"Quote",icon:tM.A,command:e=>e.chain().focus().clearNodes().toggleBlockquote().run(),isActive:e=>e.isActive("blockquote")},{name:"Code",icon:t_.A,command:e=>e.chain().focus().clearNodes().toggleCodeBlock().run(),isActive:e=>e.isActive("codeBlock")}],tI=e=>{var t;let{open:s,onOpenChange:n}=e,{editor:l}=(0,tm.aA)();if(!l)return null;let r=null!=(t=tR.filter(e=>e.isActive(l)).pop())?t:{name:"Multiple"};return(0,a.jsxs)(tx.AM,{modal:!0,open:s,onOpenChange:n,children:[(0,a.jsx)(tp,{asChild:!0,className:"hover:bg-accent gap-2 rounded-none border-none focus:ring-0",children:(0,a.jsxs)(f.$,{size:"sm",variant:"ghost",className:"gap-2",children:[(0,a.jsx)("span",{className:"text-sm whitespace-nowrap",children:r.name}),(0,a.jsx)(ej.A,{className:"h-4 w-4"})]})}),(0,a.jsx)(tf,{sideOffset:5,align:"start",className:"w-48 p-1",children:tR.map(e=>(0,a.jsxs)(eT.nR,{onSelect:t=>{e.command(t),n(!1)},className:"hover:bg-accent flex cursor-pointer items-center justify-between rounded-sm px-2 py-1 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"rounded-sm border p-1",children:(0,a.jsx)(e.icon,{className:"h-3 w-3"})}),(0,a.jsx)("span",{children:e.name})]}),r.name===e.name&&(0,a.jsx)(ea.A,{className:"h-4 w-4"})]},e.name))})]})};var tT=s(6057);function tP(e){let{className:t,orientation:s="horizontal",decorative:n=!0,...l}=e;return(0,a.jsx)(tT.b,{"data-slot":"separator-root",decorative:n,orientation:s,className:(0,r.cn)("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",t),...l})}function tE(e){let{className:t}=e;return(0,a.jsxs)("svg",{width:"469",height:"469",viewBox:"0 0 469 469",fill:"none",xmlns:"http://www.w3.org/2000/svg",shapeRendering:"geometricPrecision",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",className:t,children:[(0,a.jsx)("title",{children:"Magic AI icon"}),(0,a.jsx)("path",{d:"M237.092 62.3004L266.754 71.4198C267.156 71.5285 267.51 71.765 267.765 72.0934C268.02 72.4218 268.161 72.8243 268.166 73.2399C268.172 73.6555 268.042 74.0616 267.796 74.3967C267.55 74.7318 267.201 74.9777 266.803 75.097L237.141 84.3145C236.84 84.4058 236.566 84.5699 236.344 84.7922C236.121 85.0146 235.957 85.2883 235.866 85.5893L226.747 115.252C226.638 115.653 226.401 116.008 226.073 116.263C225.745 116.517 225.342 116.658 224.926 116.664C224.511 116.669 224.105 116.539 223.77 116.293C223.435 116.047 223.189 115.699 223.069 115.301L213.852 85.6383C213.761 85.3374 213.597 85.0636 213.374 84.8412C213.152 84.6189 212.878 84.4548 212.577 84.3635L182.914 75.2441C182.513 75.1354 182.158 74.8989 181.904 74.5705C181.649 74.2421 181.508 73.8396 181.503 73.424C181.497 73.0084 181.627 72.6023 181.873 72.2672C182.119 71.9321 182.467 71.6863 182.865 71.5669L212.528 62.3494C212.829 62.2582 213.103 62.0941 213.325 61.8717C213.547 61.6494 213.712 61.3756 213.803 61.0747L222.922 31.4121C223.031 31.0109 223.267 30.656 223.596 30.4013C223.924 30.1465 224.327 30.0057 224.742 30.0002C225.158 29.9946 225.564 30.1247 225.899 30.3706C226.234 30.6165 226.48 30.9649 226.599 31.363L235.817 61.0257C235.908 61.3266 236.072 61.6003 236.295 61.8227C236.517 62.0451 236.791 62.2091 237.092 62.3004Z",fill:"currentColor"}),(0,a.jsx)("path",{d:"M155.948 155.848L202.771 168.939C203.449 169.131 204.045 169.539 204.47 170.101C204.895 170.663 205.125 171.348 205.125 172.052C205.125 172.757 204.895 173.442 204.47 174.004C204.045 174.566 203.449 174.974 202.771 175.166L155.899 188.06C155.361 188.209 154.87 188.496 154.475 188.891C154.079 189.286 153.793 189.777 153.644 190.316L140.553 237.138C140.361 237.816 139.953 238.413 139.391 238.838C138.829 239.262 138.144 239.492 137.44 239.492C136.735 239.492 136.05 239.262 135.488 238.838C134.927 238.413 134.519 237.816 134.327 237.138L121.432 190.267C121.283 189.728 120.997 189.237 120.601 188.842C120.206 188.446 119.715 188.16 119.177 188.011L72.3537 174.92C71.676 174.728 71.0795 174.32 70.6547 173.759C70.2299 173.197 70 172.512 70 171.807C70 171.103 70.2299 170.418 70.6547 169.856C71.0795 169.294 71.676 168.886 72.3537 168.694L119.226 155.799C119.764 155.65 120.255 155.364 120.65 154.969C121.046 154.573 121.332 154.082 121.481 153.544L134.572 106.721C134.764 106.043 135.172 105.447 135.734 105.022C136.295 104.597 136.981 104.367 137.685 104.367C138.389 104.367 139.075 104.597 139.637 105.022C140.198 105.447 140.606 106.043 140.798 106.721L153.693 153.593C153.842 154.131 154.128 154.622 154.524 155.018C154.919 155.413 155.41 155.699 155.948 155.848Z",fill:"currentColor"}),(0,a.jsx)("path",{d:"M386.827 289.992C404.33 292.149 403.84 305.828 386.876 307.299C346.623 310.829 298.869 316.271 282.199 360.005C274.844 379.192 269.942 403.2 267.49 432.029C267.427 432.846 267.211 433.626 266.856 434.319C266.501 435.012 266.015 435.602 265.431 436.05C254.988 444.041 251.212 434.186 250.183 425.606C239.2 332.353 214.588 316.909 124.668 306.122C123.892 306.031 123.151 305.767 122.504 305.35C121.857 304.933 121.322 304.375 120.942 303.72C116.399 295.679 119.324 291.038 129.718 289.796C224.688 278.47 236.062 262.83 250.183 169.331C252.177 156.355 257.259 154.083 265.431 162.516C266.51 163.593 267.202 165.099 267.392 166.782C279.257 258.564 293.328 278.617 386.827 289.992Z",fill:"currentColor"})]})}var tF=s(62638);function tB(e){let{className:t,...s}=e;return(0,a.jsx)(tF.uB,{"data-slot":"command",className:(0,r.cn)("bg-popover text-popover-foreground flex h-full w-full flex-col overflow-hidden rounded-md",t),...s})}function tO(e){let{className:t,...s}=e;return(0,a.jsxs)("div",{"data-slot":"command-input-wrapper",className:"flex h-9 items-center gap-2 border-b px-3",children:[(0,a.jsx)(eo.A,{className:"size-4 shrink-0 opacity-50"}),(0,a.jsx)(tF.uB.Input,{"data-slot":"command-input",className:(0,r.cn)("placeholder:text-muted-foreground flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-hidden disabled:cursor-not-allowed disabled:opacity-50",t),...s})]})}function t$(e){let{className:t,...s}=e;return(0,a.jsx)(tF.uB.Group,{"data-slot":"command-group",className:(0,r.cn)("text-foreground [&_[cmdk-group-heading]]:text-muted-foreground overflow-hidden p-1 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium",t),...s})}function tH(e){let{className:t,...s}=e;return(0,a.jsx)(tF.uB.Separator,{"data-slot":"command-separator",className:(0,r.cn)("bg-border -mx-1 h-px",t),...s})}function tD(e){let{className:t,...s}=e;return(0,a.jsx)(tF.uB.Item,{"data-slot":"command-item",className:(0,r.cn)("data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...s})}s(51749);var tU=s(82779);let tq=e=>{let{completion:t,onDiscard:s}=e,{editor:n}=(0,tm.aA)();return n?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(t$,{children:[(0,a.jsxs)(tD,{className:"gap-2 px-4",value:"replace",onSelect:()=>{let e=n.view.state.selection;n.chain().focus().insertContentAt({from:e.from,to:e.to},t).run()},children:[(0,a.jsx)(ea.A,{className:"text-muted-foreground h-4 w-4"}),"Replace selection"]}),(0,a.jsxs)(tD,{className:"gap-2 px-4",value:"insert",onSelect:()=>{let e=n.view.state.selection;n.chain().focus().insertContentAt(e.to+1,t).run()},children:[(0,a.jsx)(tM.A,{className:"text-muted-foreground h-4 w-4"}),"Insert below"]})]}),(0,a.jsx)(tH,{}),(0,a.jsx)(t$,{children:(0,a.jsxs)(tD,{onSelect:s,value:"thrash",className:"gap-2 px-4",children:[(0,a.jsx)(tb.A,{className:"text-muted-foreground h-4 w-4"}),"Discard"]})})]}):null};var tK=s(57629),tJ=s(59038),tX=s(91138),tQ=s(77524);let tG=[{value:"improve",label:"Improve writing",icon:tK.A},{value:"shorter",label:"Make shorter",icon:tJ.A},{value:"longer",label:"Make longer",icon:tX.A}],tW=e=>{let{onSelect:t}=e,{editor:s}=(0,tm.aA)();return s?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t$,{heading:"Edit or review selection",children:tG.map(e=>(0,a.jsxs)(tD,{onSelect:e=>{let a=s.state.selection.content();t(s.storage.markdown.serializer.serialize(a.content),e)},className:"flex gap-2 px-4",value:e.value,children:[(0,a.jsx)(e.icon,{className:"h-4 w-4 text-purple-500"}),e.label]},e.value))}),(0,a.jsx)(tH,{}),(0,a.jsx)(t$,{heading:"Use AI to do more",children:(0,a.jsxs)(tD,{onSelect:()=>{let e=s.state.selection.from;t((0,eT.pk)(s,e),"continue")},value:"continue",className:"gap-2 px-4",children:[(0,a.jsx)(tQ.A,{className:"h-4 w-4 text-purple-500"}),"Continue writing"]})})]}):null};var tY=s(90598);function tZ(e){let{onOpenChange:t}=e,{editor:s}=(0,tm.aA)(),[l,r]=(0,n.useState)(""),{completion:i,complete:o,isLoading:c}=function(){let[e,t]=(0,n.useState)(""),[s,a]=(0,n.useState)(!1),[l,r]=(0,n.useState)(null);return{completion:e,complete:(0,n.useCallback)(async(e,s)=>{a(!0),r(null);try{let n=await (0,tY.x)((0,u.$)("/api/prose/generate"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({prompt:e,...null==s?void 0:s.body})}),l="";for await(let e of n)l+=e.data,t(l);return a(!1),l}catch(t){let e=t instanceof Error?t:Error("An error occurred");throw r(e),d.oR.error(e.message),a(!1),e}},[]),isLoading:s,error:l,reset:(0,n.useCallback)(()=>{t(""),r(null),a(!1)},[])}}();if(!s)return null;let m=i.length>0;return(0,a.jsxs)(tB,{className:"w-[350px]",children:[m&&(0,a.jsx)("div",{className:"flex max-h-[400px]",children:(0,a.jsx)(K,{children:(0,a.jsx)("div",{className:"prose prose-sm dark:prose-invert p-2 px-4",children:(0,a.jsx)(tU.oz,{children:i})})})}),c&&(0,a.jsxs)("div",{className:"flex h-12 w-full items-center px-4 text-sm font-medium text-purple-500",children:[(0,a.jsx)(tE,{className:"mr-2 h-4 w-4 shrink-0"}),"AI is thinking",(0,a.jsx)("div",{className:"mt-1 ml-2",children:(0,a.jsx)(P.A,{})})]}),!c&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(tO,{value:l,onValueChange:r,autoFocus:!0,placeholder:m?"Tell AI what to do next":"Ask AI to edit or generate...",onFocus:()=>(0,eT.A)(s)}),(0,a.jsx)(f.$,{size:"icon",className:"absolute top-1/2 right-2 h-6 w-6 -translate-y-1/2 rounded-full bg-purple-500 hover:bg-purple-900",onClick:()=>{if(i)return o(i,{body:{option:"zap",command:l}}).then(()=>r(""));let e=s.state.selection.content();o(s.storage.markdown.serializer.serialize(e.content),{body:{option:"zap",command:l}}).then(()=>r(""))},children:(0,a.jsx)(_.A,{className:"h-4 w-4"})})]}),m?(0,a.jsx)(tq,{onDiscard:()=>{s.chain().unsetHighlight().focus().run(),t(!1)},completion:i}):(0,a.jsx)(tW,{onSelect:(e,t)=>o(e,{body:{option:t}})})]})]})}var tV=s(67014);let t0=e=>{let{children:t,open:s,onOpenChange:l}=e,{editor:r}=(0,tm.aA)(),{isReplay:i}=(0,A.N)();return((0,n.useEffect)(()=>{!s&&r&&(0,eT.LN)(r)},[s]),r)?(0,a.jsxs)(eT.YW,{tippyOptions:{placement:s?"bottom-start":"top",onHidden:()=>{l(!1),r.chain().unsetHighlight().run()}},className:"border-muted bg-background flex w-fit max-w-[90vw] overflow-hidden rounded-md border shadow-xl",children:[s&&(0,a.jsx)(tZ,{open:s,onOpenChange:l}),!s&&(0,a.jsxs)(n.Fragment,{children:[i?(0,a.jsxs)(tV.m_,{children:[(0,a.jsx)(tV.k$,{children:(0,a.jsxs)(f.$,{className:"gap-1 rounded-none text-purple-500",variant:"ghost",size:"sm",disabled:!0,children:[(0,a.jsx)(tE,{className:"h-5 w-5"}),"Ask AI"]})}),(0,a.jsx)(tV.ZI,{children:"You can't ask AI in replay mode."})]}):(0,a.jsxs)(f.$,{className:"gap-1 rounded-none text-purple-500",variant:"ghost",onClick:()=>l(!0),size:"sm",children:[(0,a.jsx)(tE,{className:"h-5 w-5"}),"Ask AI"]}),t]})]}):null},t1=(0,eT.TK)({onUpload:e=>{let t=fetch("/api/upload",{method:"POST",headers:{"content-type":(null==e?void 0:e.type)||"application/octet-stream","x-vercel-filename":(null==e?void 0:e.name)||"image.png"},body:e});return new Promise((s,a)=>{d.oR.promise(t.then(async t=>{if(200===t.status){let{url:e}=await t.json(),a=new Image;a.src=e,a.onload=()=>{s(e)}}else if(401===t.status)throw s(e),Error("`BLOB_READ_WRITE_TOKEN` environment variable not found, reading image locally instead.");else throw Error("Error uploading image. Please try again.")}),{loading:"Uploading image...",success:"Image uploaded successfully.",error:e=>(a(e),e.message)})})},validateFn:e=>e.type.includes("image/")?!(e.size/1024/1024>20)||(d.oR.error("File size too big (max 20MB)."),!1):(d.oR.error("File type not supported."),!1)});var t2=s(8553),t4=s(1198),t3=s(42146),t5=s(74793);let t6=()=>{let{editor:e}=(0,tm.aA)();if(!e)return null;let t=[{name:"bold",isActive:e=>e.isActive("bold"),command:e=>e.chain().focus().toggleBold().run(),icon:t2.A},{name:"italic",isActive:e=>e.isActive("italic"),command:e=>e.chain().focus().toggleItalic().run(),icon:t4.A},{name:"underline",isActive:e=>e.isActive("underline"),command:e=>e.chain().focus().toggleUnderline().run(),icon:t3.A},{name:"strike",isActive:e=>e.isActive("strike"),command:e=>e.chain().focus().toggleStrike().run(),icon:t5.A},{name:"code",isActive:e=>e.isActive("code"),command:e=>e.chain().focus().toggleCode().run(),icon:t_.A}];return(0,a.jsx)("div",{className:"flex",children:t.map(t=>(0,a.jsx)(eT.nR,{onSelect:e=>{t.command(e)},children:(0,a.jsx)(f.$,{size:"sm",className:"rounded-none",variant:"ghost",type:"button",children:(0,a.jsx)(t.icon,{className:(0,r.cn)("h-4 w-4",{"text-blue-500":t.isActive(e)})})})},t.name))})};var t8=s(50614);let t7=(0,eT.FD)([{title:"Text",description:"Just start typing with plain text.",searchTerms:["p","paragraph"],icon:(0,a.jsx)(tA.A,{size:18}),command:e=>{let{editor:t,range:s}=e;t.chain().focus().deleteRange(s).toggleNode("paragraph","paragraph").run()}},{title:"To-do List",description:"Track tasks with a to-do list.",searchTerms:["todo","task","list","check","checkbox"],icon:(0,a.jsx)(tL.A,{size:18}),command:e=>{let{editor:t,range:s}=e;t.chain().focus().deleteRange(s).toggleTaskList().run()}},{title:"Heading 1",description:"Big section heading.",searchTerms:["title","big","large"],icon:(0,a.jsx)(tC.A,{size:18}),command:e=>{let{editor:t,range:s}=e;t.chain().focus().deleteRange(s).setNode("heading",{level:1}).run()}},{title:"Heading 2",description:"Medium section heading.",searchTerms:["subtitle","medium"],icon:(0,a.jsx)(tk.A,{size:18}),command:e=>{let{editor:t,range:s}=e;t.chain().focus().deleteRange(s).setNode("heading",{level:2}).run()}},{title:"Heading 3",description:"Small section heading.",searchTerms:["subtitle","small"],icon:(0,a.jsx)(tS.A,{size:18}),command:e=>{let{editor:t,range:s}=e;t.chain().focus().deleteRange(s).setNode("heading",{level:3}).run()}},{title:"Bullet List",description:"Create a simple bullet list.",searchTerms:["unordered","point"],icon:(0,a.jsx)(t8.A,{size:18}),command:e=>{let{editor:t,range:s}=e;t.chain().focus().deleteRange(s).toggleBulletList().run()}},{title:"Numbered List",description:"Create a list with numbering.",searchTerms:["ordered"],icon:(0,a.jsx)(tz.A,{size:18}),command:e=>{let{editor:t,range:s}=e;t.chain().focus().deleteRange(s).toggleOrderedList().run()}},{title:"Quote",description:"Capture a quote.",searchTerms:["blockquote"],icon:(0,a.jsx)(tM.A,{size:18}),command:e=>{let{editor:t,range:s}=e;return t.chain().focus().deleteRange(s).toggleNode("paragraph","paragraph").toggleBlockquote().run()}},{title:"Code",description:"Capture a code snippet.",searchTerms:["codeblock"],icon:(0,a.jsx)(t_.A,{size:18}),command:e=>{let{editor:t,range:s}=e;return t.chain().focus().deleteRange(s).toggleCodeBlock().run()}}]),t9=eT.uB.configure({suggestion:{items:()=>t7,render:eT.$}});s(70090),s(34919);let se=[...tu,t9],st=e=>{let{content:t,onMarkdownChange:s}=e,[l,r]=(0,n.useState)(()=>t),[i,o]=(0,n.useState)("Saved"),[c,d]=(0,n.useState)(!1),[u,m]=(0,n.useState)(!1),[x,h]=(0,n.useState)(!1),[p,f]=(0,n.useState)(!1),g=(0,eP.YQ)(async e=>{s&&s(e.storage.markdown.getMarkdown()),o("Saved")},500);return l?(0,a.jsx)("div",{className:"relative w-full",children:(0,a.jsx)(eT.ol,{children:(0,a.jsxs)(eT.$Z,{immediatelyRender:!1,initialContent:l,extensions:se,className:"border-muted relative h-full w-full",editorProps:{handleDOMEvents:{keydown:(e,t)=>(0,eT.QI)(t)},handlePaste:(e,t)=>(0,eT.bC)(e,t,t1),handleDrop:(e,t,s,a)=>(0,eT.pq)(e,t,a,t1),attributes:{class:"prose prose-base prose-p:my-4 dark:prose-invert prose-headings:font-title font-default focus:outline-none max-w-full"}},onUpdate:e=>{let{editor:t}=e;g(t),o("Unsaved")},slotAfter:(0,a.jsx)(eT.wz,{}),children:[(0,a.jsxs)(eT.DX,{className:"border-muted bg-background z-50 h-auto max-h-[330px] overflow-y-auto rounded-md border px-1 py-2 shadow-md transition-all",children:[(0,a.jsx)(eT._V,{className:"text-muted-foreground px-2",children:"No results"}),(0,a.jsx)(eT.xG,{children:t7.map(e=>(0,a.jsxs)(eT.ux,{value:e.title,onCommand:t=>{var s;return null==(s=e.command)?void 0:s.call(e,t)},className:"hover:bg-accent aria-selected:bg-accent flex w-full items-center space-x-2 rounded-md px-2 py-1 text-left text-sm",children:[(0,a.jsx)("div",{className:"border-muted bg-background flex h-10 w-10 items-center justify-center rounded-md border",children:e.icon}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-medium",children:e.title}),(0,a.jsx)("p",{className:"text-muted-foreground text-xs",children:e.description})]})]},e.title))})]}),(0,a.jsxs)(t0,{open:p,onOpenChange:f,children:[(0,a.jsx)(tP,{orientation:"vertical"}),(0,a.jsx)(tI,{open:c,onOpenChange:d}),(0,a.jsx)(tP,{orientation:"vertical"}),(0,a.jsx)(t6,{}),(0,a.jsx)(tP,{orientation:"vertical"}),(0,a.jsx)(tv,{open:u,onOpenChange:m}),(0,a.jsx)(tP,{orientation:"vertical"}),(0,a.jsx)(tN,{open:x,onOpenChange:h}),(0,a.jsx)(tP,{orientation:"vertical"}),(0,a.jsx)(ty,{})]})]})})}):null};function ss(e){let{className:t,messageId:s}=e,i=(0,l.JX)(s),{isReplay:o}=(0,A.N)(),c=(0,n.useCallback)(e=>{i&&(i.content=e,l.Pj.setState({messages:new Map(l.Pj.getState().messages).set(i.id,i)}))},[i]),d=(0,n.useRef)(null),u=(null==i?void 0:i.isStreaming)===!1&&(null==i?void 0:i.content)!=="";return(0,a.jsx)("div",{ref:d,className:(0,r.cn)("relative flex flex-col pt-4 pb-8",t),children:!o&&u?(0,a.jsx)(st,{content:null==i?void 0:i.content,onMarkdownChange:c}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(H.o,{animated:!0,children:null==i?void 0:i.content}),(null==i?void 0:i.isStreaming)&&(0,a.jsx)($,{className:"my-12"})]})})}function sa(e){let{className:t,researchId:s=null}=e,i=(0,l.Pj)(e=>s?e.researchReportIds.get(s):void 0),[o,c]=(0,n.useState)("activities"),d=(0,l.Pj)(e=>!!s&&e.researchReportIds.has(s)),u=(0,l.Pj)(e=>{var t,s;return!!i&&null!=(s=null==(t=e.messages.get(i))?void 0:t.isStreaming)&&s}),{isReplay:m}=(0,A.N)();(0,n.useEffect)(()=>{d&&c("report")},[d]);let x=(0,n.useCallback)(async()=>{s&&await (0,l.B)(s)},[s]),[h,p]=(0,n.useState)(!1),j=(0,n.useCallback)(()=>{if(!i)return;let e=l.Pj.getState().messages.get(i);e&&(navigator.clipboard.writeText(e.content),p(!0),setTimeout(()=>{p(!1)},1e3))},[i]);return(0,n.useEffect)(()=>{d||c("activities")},[d,s]),(0,a.jsx)("div",{className:(0,r.cn)("h-full w-full overflow-hidden",t),children:(0,a.jsxs)(g,{className:(0,r.cn)("relative h-full w-full pt-4 flex flex-col",t),children:[(0,a.jsxs)("div",{className:"absolute right-2 sm:right-4 flex h-9 items-center justify-center gap-1 sm:gap-2",children:[d&&!u&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(I.m,{title:"生成播客",children:(0,a.jsx)(f.$,{className:"text-gray-400",size:"icon",variant:"ghost",disabled:m,onClick:x,children:(0,a.jsx)(E.A,{className:"h-4 w-4 sm:h-5 sm:w-5"})})}),(0,a.jsx)(I.m,{title:"复制",children:(0,a.jsx)(f.$,{className:"text-gray-400",size:"icon",variant:"ghost",onClick:j,children:h?(0,a.jsx)(ea.A,{className:"h-4 w-4 sm:h-5 sm:w-5"}):(0,a.jsx)(en.A,{className:"h-4 w-4 sm:h-5 sm:w-5"})})})]}),(0,a.jsx)(I.m,{title:"关闭",children:(0,a.jsx)(f.$,{className:"text-gray-400",size:"sm",variant:"ghost",onClick:()=>{(0,l.mR)()},children:(0,a.jsx)(M.A,{className:"h-4 w-4 sm:h-5 sm:w-5"})})})]}),(0,a.jsxs)(el.tU,{className:"flex h-full w-full flex-col overflow-hidden",value:o,onValueChange:e=>c(e),children:[(0,a.jsx)("div",{className:"flex w-full justify-center mb-2",children:(0,a.jsxs)(el.j7,{className:"h-8 sm:h-10",children:[(0,a.jsx)(el.Xi,{className:"px-4 sm:px-8 text-sm sm:text-base",value:"report",disabled:!d,children:"研报"}),(0,a.jsx)(el.Xi,{className:"px-4 sm:px-8 text-sm sm:text-base",value:"activities",children:"分析过程"})]})}),(0,a.jsx)(el.av,{className:"flex-1 min-h-0 px-5 overflow-hidden",value:"report",forceMount:!0,hidden:"report"!==o,children:(0,a.jsx)(X,{className:"h-full pb-20",scrollShadowColor:"var(--card)",autoScrollToBottom:!d||u,children:i&&s&&(0,a.jsx)(ss,{className:"mt-4",researchId:s,messageId:i})})}),(0,a.jsx)(el.av,{className:"flex-1 min-h-0 px-5 overflow-hidden",value:"activities",forceMount:!0,hidden:"activities"!==o,children:(0,a.jsx)(X,{className:"h-full pb-20",scrollShadowColor:"var(--card)",autoScrollToBottom:!d||u,children:s&&(0,a.jsx)(eC,{className:"mt-4",researchId:s})})})]})]})})}var sn=s(91118);function sl(e){let{className:t,onSelectChat:s,onNewChat:i}=e,[o,c]=(0,n.useState)([]),[m,x]=(0,n.useState)(null),h=(0,l.Pj)(e=>e.userId),p=(0,n.useCallback)(async()=>{let e=localStorage.getItem("auth_token");if(e&&h)try{let t=await fetch((0,u.$)("reports?user_id=".concat(h)),{headers:{Authorization:"Bearer ".concat(e)}});if(!t.ok)throw Error("Failed to load chat histories");let s=await t.json();c(s)}catch(e){console.error("Failed to load chat histories:",e),d.oR.error("Failed to load chat histories")}},[h]);(0,n.useEffect)(()=>{p()},[p]);let g=async(e,t)=>{let s=localStorage.getItem("auth_token");if(s&&h)try{if(!(await fetch((0,u.$)("reports/".concat(e,"?user_id=").concat(h)),{method:"DELETE",headers:{Authorization:"Bearer ".concat(s)}})).ok)throw Error("Failed to delete chat");c(t=>t.filter(t=>t.id!==e)),m===t&&x(null),d.oR.success("Chat deleted successfully")}catch(e){console.error("Failed to delete chat:",e),d.oR.error("Failed to delete chat")}},j=e=>{x(e),null==s||s(e)};return(0,a.jsxs)("div",{className:(0,r.cn)("flex flex-col w-64 p-4 mt-14",t),children:[(0,a.jsxs)(f.$,{className:"mb-4 w-full",onClick:()=>{x(null),null==i||i()},children:[(0,a.jsx)(sn.A,{className:"mr-2 h-4 w-4"}),"新对话"]}),(0,a.jsx)("div",{className:"flex flex-col space-y-2",children:o.map(e=>(0,a.jsxs)("div",{className:(0,r.cn)("flex items-center justify-between p-2 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-800",m===e.thread_id&&"bg-gray-100 dark:bg-gray-800"),onClick:()=>j(e.thread_id),children:[(0,a.jsxs)("div",{className:"flex flex-col flex-1 min-w-0",children:[(0,a.jsx)("div",{className:"font-medium truncate",children:e.title||"新对话"}),(0,a.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:new Date(e.updated_at).toLocaleString()})]}),(0,a.jsx)(f.$,{variant:"ghost",size:"icon",className:"ml-2 opacity-0 group-hover:opacity-100",onClick:t=>{t.stopPropagation(),g(e.id,e.thread_id)},children:(0,a.jsx)(tb.A,{className:"h-4 w-4"})})]},e.id))})]})}function sr(){let e=(0,l.Pj)(e=>e.openResearchId),t=(0,n.useMemo)(()=>null!==e,[e]),[s,i]=(0,n.useState)(null),o=(0,n.useCallback)(e=>{i(e)},[]),c=(0,n.useCallback)(()=>{i(null)},[]);return(0,a.jsxs)("div",{className:"flex h-[calc(100vh-140px)] sm:h-[calc(100vh-180px)] w-full",children:[(0,a.jsx)(sl,{className:"hidden sm:flex border-r",onSelectChat:o,onNewChat:c}),(0,a.jsx)("div",{className:"flex flex-1 justify-center",children:(0,a.jsxs)("div",{className:(0,r.cn)("flex flex-col sm:flex-row justify-center gap-4 sm:gap-8 px-2 sm:px-0 pt-2 sm:pt-0 w-full",t?"gap-4 sm:gap-8":""),children:[(0,a.jsx)(es,{className:(0,r.cn)("shrink-0 transition-all duration-300 ease-out",t?"w-full sm:w-[538px]":"w-full sm:w-[768px] translate-x-0 sm:translate-x-[min(calc((100vw-538px-256px)*0.75/2),960px/2)]",t?"h-[calc(50vh-100px)] sm:h-full":"h-full"),selectedChatId:s}),(0,a.jsx)(sa,{className:(0,r.cn)("w-full sm:w-[min(calc((100vw-538px-256px)*0.75),960px)] transition-all duration-300 ease-out",t?"h-[calc(50vh-100px)] sm:h-full":"h-0 sm:scale-0 overflow-hidden"),researchId:e})]})})]})}}}]);